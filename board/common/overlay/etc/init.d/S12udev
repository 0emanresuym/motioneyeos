#!/bin/bash

CONF=/etc/udev/udev.conf


test -f $CONF || exit 0

test -n "$OS_VERSION" || source /etc/init.d/base

source $CONF

start() {
    msg_begin "Starting eudev"
    echo '\000\000\000\000' > /proc/sys/kernel/hotplug
    /sbin/udevd --daemon --resolve-names=never
    test $? == 0 && msg_done || msg_fail

    /sbin/udevadm trigger --type=subsystems --action=add
    /sbin/udevadm trigger --type=devices --action=add
    /sbin/udevadm settle --timeout=30

    return 0
}

stop() {
    msg_begin "Stopping eudev"
    udevadm control --stop-exec-queue
    killall udevd &>/dev/null
    test $? == 0 && msg_done || msg_fail
}

case "$1" in
    start)
        start
        ;;

    stop)
        stop
        ;;
    
    restart)
        stop
        start
        ;;

    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac

exit $?

